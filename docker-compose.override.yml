# docker-compose.override.yml
# 
# Este archivo se aplica AUTOMÁTICAMENTE sobre docker-compose.yml
# cuando ejecutas `docker-compose up` en desarrollo local.
#
# Simula el entorno de producción t3.small (2 vCPU, 2GB RAM)
# para garantizar paridad entre desarrollo y producción.

version: '3.8'

services:
  w2m:
    build:
      context: .
      target: development    # Usar stage de desarrollo con hot-reload
    
    # Simular límites de t3.small
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G         # Igual que t3.small
        reservations:
          memory: 512M
    
    # Hot-reload: montar código fuente
    volumes:
      - ./src:/app/src:ro                # Código fuente (read-only)
      - ./data/session:/app/data/session # Sesión WhatsApp
      - ./data/vault:/app/data/vault     # Vault de Markdown
      - ./data/logs:/app/data/logs       # Logs
    
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty    # Logs legibles en terminal (no JSON)
    
    # Puerto para debugging con Node.js Inspector
    ports:
      - "9229:9229"
    
    # Comando de desarrollo con hot-reload y debugger
    command: ["npx", "tsx", "watch", "--inspect=0.0.0.0:9229", "src/index.ts"]
    
    # Stdin para interacción (escanear QR, etc.)
    stdin_open: true
    tty: true

